PROCEDURE BAJ_DAT()
PRIVATE COD := SPACE(8) , FEB := CTOD('') , DES, LIN

 
CLS
@  0,31 SAY "旼컴컴컴컴컴컴컴커"
@  1,31 SAY " VACA:          "
@  2,31 SAY "읕컴컴컴컴컴컴컴켸"
@  1,39 GET COD PICTURE "@!" VALID EXISTE(COD)
MENSAJE('INGRESE EL CODIGO')
SET CURSOR ON
READ
SET CURSOR OFF
@24, 0 CLEAR

LIN=VACA(COD)
MOSTRAR(LIN, 3)

MENSAJE('<B> DA DE BAJA REGISTRO     <Enter> VOLVER AL MENU')
X=0
DO WHILE X#13 .AND. UPPER(CHR(X))#'B'
   X=INKEY()
ENDDO
IF UPPER(CHR(X))='B'
   @ 4 ,26 CLEAR TO  8,71
   @ 4 ,26 TO  8,71 DOUBLE
   @ 6,29 SAY 'MOTIVO:'
   PRIVATE LI:=6, MOT
   IF CODRFL = SPACE(4)
      SELECT MOTIVO
      GO TOP
      PRIVATE AR1[ LASTREC() ], ARS[ LASTREC() ] , Y := 1
      DO WHILE !EOF()
         AR1[Y] = CONMOT
         IF Y#1
            ARS[1]=.T.
         ELSE
            ARS[Y]=.F.
         ENDIF
         SKIP
         Y=Y+1
      ENDDO
      PANT = SAVESCREEN(LI,37,LI+6,58)
      @ LI,37 TO LI+6,58 DOUBLE
      MO = ACHOICE (LI+1,38,LI+5,57, AR1, ARS, 3 )
      GO MO
      MOT=CODMOT
      RESTSCREEN(LI,37,LI+6,58,PANT)
   ELSE
      MOT = CODRFL
   ENDIF
   SETCOLOR(INVER)
   @ LI  ,37 SAY MOT
   SETCOLOR(COMUN)
   @ 6,42 SAY 'FECHA:' GET FEB VALID FEB>CTOD('  /  /  ')
   SET CURSOR ON
   READ
   SET CURSOR OFF
   @ 6,59 SAY 'DESTINO:'
   PRIVATE AR3 := {'VENTA','MUERTA'}
   PANT = SAVESCREEN(LI,68,LI+3,75)
   @ LI,68 TO LI+3,75 DOUBLE
   DE = ACHOICE (LI+1,69,LI+2,74,AR3, 3)
   RESTSCREEN(LI,68,LI+3,75,PANT)
   IF DE = 1
      DES = 'V'
   ELSE
      DES = 'M'
   ENDIF
   SETCOLOR(INVER)
   @ LI  ,68 SAY DES
   SETCOLOR(COMUN)
   IF ACEPTA()

      @24, 0 CLEAR
      SELECT TAMBO
      FP=FECPAR
      DELETE
      IF FP>CTOD('  /  /  ')
         SELECT BACENF
         APPEND FROM ENFERM FOR CODVAC = COD
         APPEND BLANK
         REPLACE CODVAC WITH COD, FECHA  WITH FEB
         REPLACE MOTIV1 WITH MOT, DESTIN WITH DES
      ENDIF
      SELECT ENFERM
      DELETE FOR CODVAC = COD
      SELECT BACSER
      APPEND FROM SERVIC FOR CODVAC=COD
      SELECT SERVIC
      DELETE FOR CODVAC=COD
      IF FP >CTOD('  /  /  ')
         SELECT VACTOT
         LOCATE FOR ANIO=YEAR(FEB)
         IF !FOUND()
            APPEND BLANK
            REPLACE ANIO WITH YEAR(FEB)
         ENDIF
         REPLACE ACTUA WITH .T.
      ENDIF
      SETCOLOR(INVER)
      MENSAJE('EL REGISTRO HA SIDO DADO DE BAJA. CUALQUIER TECLA CONTINUAR...')
      SETCOLOR(COMUN)
      INKEY(0)
   ELSE
      RETURN
   ENDIF
ENDIF
SETCOLOR(COMUN)