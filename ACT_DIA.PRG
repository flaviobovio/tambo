PROCEDURE ACT_DIA()
CLS
MARCO( 7,15,13,63)
PRIVATE V_TOT:=0
@  9,26 SAY "POR FAVOR ESPERE UN MOMENTO"
@ 11,18 SAY "LOS DATOS DIARIOS ESTAN SIENDO ACTUALIZADOS"
SELECT TAMBO
DBEVAL( { || FIELD->DIASEC:=IF ( FINLAC=CTOD('  /  /  '), 0, VAL( STR(DIA-FINLAC,3)) ), ;
             FIELD->DIALAC:=IF ( FINLAC=CTOD('  /  /  '), VAL( STR( IF(DIA-FECPAR-1>0,DIA-FECPAR-1,0),3) ), DIALAC ), ;
             FIELD->DIAGES:=IF ( FECSER#CTOD('  /  /  ').AND.RESULT='P'.AND.FECPAR<FECSER, VAL( STR(DIA-FECSER,3) ), 0 ),;
             V_TOT += IF(NROPAR>0, 1, 0) };
             ,{!DELETED()})
select guache
replace candia with val (str(dia-fecent,3)) for fecsal = CTOD('  /  /  ')

SELECT CONFIG
REPLACE FECHA WITH DIA
*
SELECT VACTOT
LOCATE FOR ANIO = YEAR(DIA)
IF !FOUND()
   APPEND BLANK
   REPLACE ANIO WITH YEAR (DIA)
ENDIF
IF ACTUA
   SELECT VACTOT
   V_TOT = ROUND( (V_TOT+VACTOT) / 2 ,0 )
   REPLACE ACTUA WITH .F., VACTOT WITH V_TOT
ENDIF
COMMIT