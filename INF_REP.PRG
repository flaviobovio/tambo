PROCEDURE INF_REP()
PRIVATE INS:={}, S_DAI:={}, V_PRI:={}, D_INI:={}
PRIVATE TOR:={}, S_DAT:={}, V_PRT:={}, D_INT:={}
PRIVATE S_DAD:=0, V_INS:=0, V_TAC:=0, P_SER:=0, V_VAC:=0
PRIVATE V_PRE:=0, P_1SE:=0, P_2SE:=0, P_3SE:=0, P_4SE:=0
PRIVATE I_CE1:=0, I_CE2:=0, I_CE3:=0, I_CE4:=0, I_CE5:=0
PRIVATE P_P1S:=0, P_PTO:=0, D_VAP:=0, I_P1S:=0, S_P1S:=0, I_PPR:=0, S_PPR:=0
PRIVATE I_OBS:=0, C_INS:=0, C_TOR:=0, P_C28:=0, C_C28:=0, P_VPR:=0
PRIVATE AN:=0, ME:=0, CC:=SPACE(4), V, FT

CLS
@  0, 0 TO 23,79 DOUBLE
@  0, 2 SAY " EVALUACION REPRODUCTIVA DE UN MES "
@  2,24 TO  4,54 DOUBLE
@  3,27 SAY "MES/A¥O A INFORMAR:" GET ME PICTURE '99/' VALID ME>0 .AND. ME<13
@  3,50 GET AN PICTURE'9999'
SET CURSOR ON
READ

SET CURSOR OFF
FT=ULT_DIA(CTOD( '01/' + IF(ME>9, STR(ME,2), '0'+STR(ME,1)) + '/'+STR(AN,2)))
@ 6,32 TO  9,47 DOUBLE
@ 7,34 PROMPT 'VACAS       '
@ 8,34 PROMPT 'VAQUILLONAS '
MENU TO V
SELECT TEMPO
MARCO(12,11,16,67 )
@14,15  SAY 'PROCESANDO LOS DATOS . POR FAVOR ESPERE UN MOMENTO'
DO CASE
CASE V = 1
   V='VACAS'
   SELECT SERVIC
   COPY TO T1 FOR YEAR(FECSER)=AN .AND. MONTH(FECSER)=ME .AND. NROPAR>0 SDF
   SELECT BACSER
   COPY TO T2 FOR YEAR(FECSER)=AN .AND. MONTH(FECSER)=ME .AND. NROPAR>0 SDF       
   SELECT TEMPO
   APPEND FROM T1 SDF
   APPEND FROM T2 SDF
* NO anda en win95
*   APPEND FROM SERVIC FOR YEAR(FECSER)=AN .AND. MONTH(FECSER)=ME .AND. NROPAR>0
*   APPEND FROM BACSER FOR YEAR(FECSER)=AN .AND. MONTH(FECSER)=ME .AND. NROPAR>0
CASE V = 2
   V='VAQUILLONAS'
   SELECT SERVIC
   COPY TO T1 FOR YEAR(FECSER)=AN .AND. MONTH(FECSER)=ME .AND. NROPAR=0 SDF
   SELECT BACSER
   COPY TO T2 FOR YEAR(FECSER)=AN .AND. MONTH(FECSER)=ME .AND. NROPAR=0 SDF       
   SELECT TEMPO
   APPEND FROM T1 SDF
   APPEND FROM T2 SDF
*   APPEND FROM SERVIC FOR YEAR(FECSER)=AN .AND. MONTH(FECSER)=ME .AND. NROPAR=0
*   APPEND FROM BACSER FOR YEAR(FECSER)=AN .AND. MONTH(FECSER)=ME .AND. NROPAR=0
OTHER
   RETURN
ENDCASE
COMMIT

SET RELATION TO CODVAC INTO TAMBO
GO TOP
DO WHILE !EOF()

   ***   SERVICIOS DADOS   ***
   S_DAD++

   ***   INSEMINADAS   ***
   V_INS += IF(FIELD->CODVAC#CC, 1, 0)
   CC=FIELD->CODVAC

   ***   TACTADAS   ***
   V_TAC += IF(RESULT # ' ', 1, 0 )

   ***   1eros SERVICIOS   ***
   P_SER += IF(NROSER =1, 1, 0)


   IF RESULT = 'P'
      ***   PRE¥ADAS   ***
      P_1SE += IF(NROSER =1, 1, 0 )
      P_2SE += IF(NROSER =2, 1, 0 )
      P_3SE += IF(NROSER =3, 1, 0 )
      P_4SE += IF(NROSER>=4, 1, 0 )

   ELSE
      ***   VACIAS   ***
      V_VAC ++

   ENDIF

   ***   INTERVALOS E/CELOS   ***
   IF ANTSER # CTOD('  /  /  ')
      I_CE1 += IF((FECSER-ANTSER)<=17, 1, 0 )
      I_CE2 += IF((FECSER-ANTSER)>=18.AND.(FECSER-ANTSER)<=25 , 1, 0 )
      I_CE3 += IF((FECSER-ANTSER)>=26.AND.(FECSER-ANTSER)<=33 , 1, 0 )
      I_CE4 += IF((FECSER-ANTSER)>=34.AND.(FECSER-ANTSER)<=49 , 1, 0 )
      I_CE5 += IF((FECSER-ANTSER)>=50 , 1, 0 )
   ENDIF

   ***   INEFICIENCIA DE OBS. E/CELOS   ***
   I_OBS += IF(RESULT='V', 1, 0 )

   ***   % CELO 28 DIAS   ***
   P_C28 += IF(FECSER>=(FT-28).AND.FECSER<=FT, 1, 0)
   C_C28 += IF(TAMBO->DIALAC>0.AND.TAMBO->REFILA=' '.AND.RESULT#'P'.AND.(DIA-FECPAR)>=30, 1, 0)

   ***   INTERV.PARTO/1er SERV.   ***
   IF NROSER=1 .AND. FECPAR#CTOD('  /  /  ')
      I_P1S += (FECSER-FECPAR)
      S_P1S ++
   ENDIF

   ***   INTERV.PARTO/PRE¥EZ   ***
   IF RESULT='P' .AND. FECPAR#CTOD('  /  /  ')
      I_PPR += (FECSER-FECPAR)
      S_PPR ++
   ENDIF

   ***   INSEMINADORES   ***
   X = ASCAN(INS, INSEMI)
   IF X = 0
      AADD(INS  , INSEMI)
      C_INS++
   ENDIF
   ***   TOROS   ***
   X = ASCAN(TOR, TORO)
   IF X = 0
      AADD(TOR  , TORO)
      C_TOR++
   ENDIF

   SKIP
ENDDO

SET RELATION TO

P_C28 = ROUND( C_C28 / P_C28 * 100 , 2)
I_P1S/= S_P1S
I_PPR/= S_PPR
V_PRE = P_1SE + P_2SE + P_3SE + P_4SE
P_P1S = ROUND( P_1SE / P_SER * 100 , 2 )
P_PTO = ROUND( V_PRE / V_INS * 100 , 2 )
D_VAP = ROUND( S_DAD / V_PRE , 2 )
I_P1S = ROUND( I_P1S , 0)
I_PPR = ROUND( I_PPR , 0)
I_OBS = ROUND( I_OBS / V_TAC * 100 , 2 )

***   EVALUACION DE TOROS E INSEMINADORES   ***

PRIVATE E_INS:=ARRAY(C_INS, C_TOR+1, 15), E_TOR := ARRAY (C_TOR, 15),;
        I, T, NS
AADD(INS, 'TOTAL')

* I
I=1
T=1
NS=1
DO WHILE I<=C_INS
   E_INS[I,T,NS]=0

   IF NS<15
      NS++
   ELSEIF T<C_TOR+1
      NS=1
      T++
   ELSE
     NS=1
     T=1
     I++
   ENDIF
ENDDO

* T
T=1
NS=1
DO WHILE T<=C_TOR
   E_TOR[T,NS]=0

   IF NS<15
      NS++
   ELSE
     NS=1
     T++
   ENDIF
ENDDO

GO TOP
DO WHILE !EOF()

   NS=(IF(NROSER<4, NROSER, 4)-1) * 3
   T =ASCAN(TOR,FIELD->TORO  )
   I =ASCAN(INS,FIELD->INSEMI)

   ***   SERV.DADOS   ***
   VA = IF(INSEMI=INS[I].AND.TORO=TOR[T], 1, 0)
   * I
   E_INS[I,T,1+NS]       += VA
   E_INS[I,T,13]         += VA
   E_INS[I,C_TOR+1,1+NS] += VA
   E_INS[I,C_TOR+1,13]   += VA
   * T
   E_TOR[T,1+NS]       += VA
   E_TOR[T,13  ]       += VA

   ***   PRE¥ADAS   ***
   VA = IF(INSEMI=INS[I].AND.TORO=TOR[T].AND.RESULT='P', 1, 0)
   * I
   E_INS[I,T,2+NS]       += VA
   E_INS[I,T,14]         += VA
   E_INS[I,C_TOR+1,2+NS] += VA
   E_INS[I,C_TOR+1,14]   += VA
   * T
   E_TOR[T,2+NS]       += VA
   E_TOR[T,14]         += VA

   ***   DOSIS   ***
   * I
   E_INS[I,T,3+NS]       = ROUND(E_INS[I,T,1+NS]      /E_INS[I,T,2+NS],2)
   E_INS[I,T,15]         = ROUND(E_INS[I,T,13]        /E_INS[I,T,14],2)
   E_INS[I,C_TOR+1,3+NS] = ROUND(E_INS[I,C_TOR+1,1+NS]/E_INS[I,C_TOR+1,2+NS],2)
   E_INS[I,C_TOR+1,15]   = ROUND(E_INS[I,C_TOR+1,13]  /E_INS[I,C_TOR+1,14],2)
   * T
   E_TOR[T,3+NS]       = ROUND(E_TOR[T,1+NS]      /E_TOR[T,2+NS],2)
   E_TOR[T,15]         = ROUND(E_TOR[T,13]        /E_TOR[T,14],2)


   SKIP
ENDDO

ZAP

IMP_REP ()

# INCLUDE 'IMP_REP.PRG'
